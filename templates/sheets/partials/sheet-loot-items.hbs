<div class="items-list">
    <header style="grid-template-columns:{{gridTemplate}}">
        <div class="item-name flexrow">{{localize 'MonksEnhancedJournal.Items'}}</div>
        <div class="item-detail item-from">{{localize 'MonksEnhancedJournal.From'}}</div>
        {{#if canRequest}}<div class="item-detail item-requests">{{localize 'MonksEnhancedJournal.Requests'}}</div>{{/if}}
        <div class="item-detail item-quantity">{{localize 'MonksEnhancedJournal.Qty'}}</div>
        {{#if @root.showrequest}}<div class="item-controls flexrow"></div>{{/if}}
        {{#if owner}}
        <div class="item-controls flexrow owner-only">
            <a class="item-control roll-table" data-tooltip="{{localize 'MonksEnhancedJournal.PopulateFromRollTable'}}" data-action="rollItem"><i class="fas fa-th-list"></i></a>
            <a class="item-control clear-items" data-tooltip="{{localize 'MonksEnhancedJournal.ClearAllItems'}}" data-action="clearItems"><i class="fas fa-dumpster"></i></a>
        </div>
        {{/if}}
    </header>
    {{#if has.items}}
    <ol class="item-list{{#if owner}} can-grant{{/if}}" data-container="items">
        {{#each groups}}
        <li data-id="{{this.id}}">
            <header class="collapsible {{#if this.collapsed}} collapsed{{/if}}">
                <div class="item-name noborder flexrow">{{localize this.name}} <span class="collapse-text item-count">({{this.items.length}} {{localize 'MonksEnhancedJournal.items'}})</span></div>
            </header>
        </li>
        <li {{#if this.collapsed}} style="display: none;" {{/if}}>
            <ol style="grid-template-columns:{{@root.gridTemplate}}">
                {{#each this.items}}
                <li class="item flexrow" data-id="{{this._id}}" data-document="Item" draggable="false">
                    <div class="item-name flexrow">
                        <div class="item-image item-icon" style="background-image: url('{{this.img}}')" data-action="clickItem"></div>
                        <div class="name" data-action="itemSummary">
                            {{this.name}}
                            {{#if this.identifiedname}} <span class="identified-name" data-tooltip="{{this.identifiedname}}"><i class="fas fa-circle-question"></i></span>{{/if}}
                            {{#if (gt this.qtyof 1)}} <span class="highlight-text groups-of">(in groups of {{this.qtyof}})</span>{{/if}}
                        </div>
                    </div>

                    <div class="item-detail item-from flexrow">
                        <input type="text" name="flags.monks-enhanced-journal.items.{{this._id}}.flags.monks-enhanced-journal.from" value="{{this.from}}" />
                    </div>

                    {{#if @root.canRequest}}
                    <div class="item-detail item-requests">
                        <ul class="request-players">
                            {{#each this.requests as |user i|}}
                            <li class="loot-player" data-tooltip="{{user.name}}" data-action="grantItem" data-user-id="{{user.id}}" style="background-color: {{user.color}};border-color: {{user.border}};">{{user.letter}}</li>
                            {{/each}}
                        </ul>
                    </div>
                    {{/if}}

                    <div class="item-detail item-quantity">
                        <input type="number" min="0" name="flags.monks-enhanced-journal.items.{{this._id}}.flags.monks-enhanced-journal.quantity" value="{{this.quantity}}" style="text-align:center;" />
                    </div>

                    {{#if @root.showrequest}}
                    <div class="item-detail item-request" style="text-align:center;">
                        <a class="item-control request-item" data-action="requestItem"><i class="fas {{this.icon}}"></i> {{this.text}}</a>
                    </div>
                    {{/if}}

                    {{#if @root.owner}}
                    <div class="item-controls flexrow owner-only">
                        <a class="item-control item-edit" data-tooltip="{{localize 'MonksEnhancedJournal.EditItem'}}" data-action="editItem"><i class="fas fa-edit"></i></a>
                        <a class="item-control item-delete" data-tooltip="{{localize 'MonksEnhancedJournal.DeleteItem'}}" data-action="deleteItem"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/if}}
                </li>
                {{/each}}
            </ol>
        </li>
        {{/each}}
    </ol>
    {{else}}
    <div class="instruction">{{#if owner}}{{localize 'MonksEnhancedJournal.msg.DragItemsHereToAddToLoot'}}{{else}}{{localize 'MonksEnhancedJournal.msg.NoLootAtTheMoment'}}{{/if}}</div>
    {{/if}}
</div>